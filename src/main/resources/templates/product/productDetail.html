<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="/static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="/static/css/agency.min.css" rel="stylesheet">
</head>
<body>
<div th:include="include/nav::nav"></div>
<div style="height: 80px"></div>
<h1>제품 상세페이지</h1>
<table>
    <tr>
        <td rowspan="5">
            <div><img th:src="@{/uploads/thumbnail/}+${map.product.thumb_300 }" /></div>
        </td>
        <td>
            <div><span>상품 브랜드 :</span> <span th:text="${map.product.p_brand}"></span></div>

        </td>
    </tr>
    <tr>
        <td>
            <div><span>상품 이름 :</span> <span th:text="${map.product.p_name}"></span></div>

        </td>
    </tr>
    <tr>
        <td>
            <div><span>상품 가격 :</span> <span th:text="${map.product.p_price}"></span>원</div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="row">
                <div class="col col-10">
                    <label class="select">
                        <select class="select" name="option" id="po_id">
                            <option th:each="option : ${map.option}" th:value="${option.po_id}" th:text="${option.po_value} + '  : + ' + ${option.po_price}
                                    +'   재고량=   '+${option.po_stock}">
                            </option>
                        </select>
                        <select class="form-control select-checkbox" id="cart_amount" multiple="multiple">
                            <th:block th:each="option : ${map.option}">
                                <option th:each="i : ${#numbers.sequence(1,option.po_stock)}" th:value="${i}" th:text="${i}" th:selected="${i==1}">
                            </th:block>
                        </select>
                    </label>
                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <input type="button" id = "cart" value ="장바구니 담기" onclick = "goCart(this);" th:attr="data-p_id=${map.product.p_id}">
            <input type="button" id = "buy" value = "구매하기" onclick = "buy();">

        </td>
    </tr>
</table>
    <div style="size: 0.3px"><span>상품상세 :</span> <span th:text="${map.product.p_spec}"></span>
        <img th:src = "@{/uploads/detailimg/}+${map.product.detailimg_name}"/>
    </div>

<script type="text/javascript" th:inline="javascript">

    var cam = /*[[${session.member}]]*/;
    console.log(cam);

    var goCart = function(obj){
        if(cam!=null){
            var po_id = parseInt($.trim(($("#po_id option:selected").val())));
            var cart_amount = parseInt($.trim(($("#cart_amount option:selected").val())));
            var p_id = $(obj).data("p_id");
            var m_no = cam.m_no;
            console.log(m_no);
            console.log(po_id);
            console.log(cart_amount);
            console.log(p_id);
            var list = [];
            list.push(po_id);
            list.push(cart_amount);
            list.push(p_id);
            list.push(m_no);
            console.log(list);
            var ojb = { "cart" : list};

            $.ajax({
                url : '/payment/goCart/',
                type : 'post',
                data : ojb,
                dataType : 'json',
                success : function(data){
                    console.log(data);
                    alert("회원님의 장바구니에 담겼습니다!");
                },
                error : function(error){
                    console.log(error);
                    alert("장바구니담기 실패!");
                }
            })

    }

        else{
            alert("로그인 후 이용해주세요!");
            location.href = "/member/login";
        }

    };


</script>
</body>
</html>